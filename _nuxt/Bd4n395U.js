import{n as e,aA as t,cc as r,a2 as a,at as s,au as o,bE as n,bF as l,ic as i,D as c,E as u,ay as d,nB as p,dL as m,ac as x,cd as f,bC as v,bN as b,a7 as h,c as _,o as k,a as y,S as g,b as w,M as C,H as N,aa as S,K as $,J as A,w as T,a5 as M,a6 as F,e as j,d as I,cN as V,ae as B,t as E,a8 as L,cQ as R,al as H,P,F as W,_ as z,am as D}from"./pxHhHUe5.js";import{E as J}from"./uG3PizZo.js";const K={class:"h-32px bg-[--secondary-bg] flex items-center"},O={class:"pl-16px pr-8px flex items-center gap-8px text-[--icon-color]"},Q=z(e({__name:"tokenHistory",setup(e){const z=t(),D=r(),Q=a(),Z=s(),q=o(),G=n("topColTab",1),U=l("scrollbar"),X=W(0),Y=l("scrollContent"),{width:ee}=i(Y),te=d([]),re=u(()=>1===G.value),ae=u(()=>{var e;const t=Array.from((null==(e=Y.value)?void 0:e.children)||[]).reduce((e,t)=>e+t.getBoundingClientRect().width,0),r=Math.max(18*(ne.value.length-1),0);return ee.value<t+r}),se=u(()=>{var e;return"evm"===(null==(e=x(q.chain))?void 0:e.vm_type)}),oe=u(()=>Z.userInfo?Z.userInfo.addresses.map(({address:e,chain:t})=>e+"-"+t):q.address&&se.value&&"WatchWallet"!==q.walletName?[q.address+"-bsc",q.address+"-base",q.address+"-eth"]:[q.address+"-"+q.chain]),ne=u(()=>({0:te.value,1:Q.lastVisitTokens}[G.value]));function le(){"-"!==oe.value[0]?p({hide_risk:Q.hide_risk,hide_small:Q.hide_small,user_ids:oe.value,pageSize:20}).then(e=>{te.value=(e.data||[]).map(e=>{var t;return{...e,id:e.token===m?(null==(t=x(e.chain))?void 0:t.wmain_wrapper)+"-"+e.chain:`${e.token}-${e.chain}`}})}):te.value.length=0}function ie(){Q.lastVisitTokens.length=0}function ce(e){U.value&&U.value.setScrollLeft(X.value+e)}function ue({scrollLeft:e}){X.value=e}c(G,()=>{0===G.value&&le()},{immediate:!0}),c(()=>[Z.evmAddress,q.address,q.walletSignature[q.address]],()=>{le()});const de={0:function(e){const t={};e.prices.forEach(e=>{t[e.token+"-"+e.chain]=e}),te.value=te.value.map(e=>{const r=t[e.id];if(r&&r.uprice>0){const t="--"===e.total_profit||0===Number(e.total_profit),a=new v(e.balance||0).times(r.uprice||0);if(t)return{...e,current_price_usd:r.uprice,balance_usd:a.toNumber()};{const t=new v(e.balance_usd||0).minus(e.total_profit||0),s=a.minus(t),o=new v(r.uprice||0).minus(e.average_purchase_price_usd||0).div(e.average_purchase_price_usd);return o.toNumber()<-1||Number(e.average_purchase_price_usd)<0?e:{...e,current_price_usd:r.uprice,balance_usd:a.toNumber(),total_profit:s.toFixed(),total_profit_ratio:o.toFixed()}}}return e})},1:function(e){Q.lastVisitTokens=Q.lastVisitTokens.map(t=>{const r=e.prices.find(e=>t.id===e.token+"-"+e.chain);return r?{...t,price:r.uprice,price_change:Number(r.price_change),price_change_v2:Number(r.price_change_v2)}:t})}};return c(()=>D.wsResult[f.PRICEV2],e=>{const t=de[G.value];t&&t(e)}),c(()=>D.wsResult[f.ASSET],e=>{var t;if(!re.value)if(e.swap){const t="So11111111111111111111111111111111111111112"===e.swap.token||e.swap.token===m?m:e.swap.token,r=e.swap.chain;t&&r&&setTimeout(()=>{le()},5e3)}else if(e.transfer){const r=e.transfer.chain,a=e.transfer.token,s=e.transfer.type;if(a&&r){const o=te.value.findIndex(e=>e.token===a&&e.chain===r),n="0"===s;if(o>-1){const r=te.value[o],a=Number(r.balance),s=r.current_price_usd,l=new v(a).plus(n?e.transfer.amount:-(null==(t=e.transfer)?void 0:t.amount)),i=l.multipliedBy(s);r.balance=l.toString(),r.balance_usd=i.toNumber(),b(te)}else setTimeout(()=>{le()},5e3)}}}),(e,t)=>{const r=S,a=V,s=j,o=J,n=h("tooltip");return k(),_("div",K,[y("div",O,[C((k(),N(r,{key:0,name:"custom:position",class:$(["cursor-pointer hover:color-[--secondary-text]",0===A(G)?"text-[--secondary-text]":""]),onClick:t[0]||(t[0]=e=>G.value=0)},null,8,["class"])),[[n,e.$t("positions")]]),C((k(),N(r,{key:1,name:"custom:history-fill",class:$(["cursor-pointer hover:color-[--secondary-text]",1===A(G)?"text-[--secondary-text]":""]),onClick:t[1]||(t[1]=e=>G.value=1)},null,8,["class"])),[[n,e.$t("history")]])]),A(ae)?(k(),_("div",{key:0,class:"w-24px h-32px flex items-center justify-center cursor-pointer text-[--secondary-text] hover:text-[--main-text]",onClick:t[2]||(t[2]=e=>ce(-200))},[w(r,{name:"material-symbols:arrow-back-ios-new-rounded"})])):g("",!0),w(o,{ref_key:"scrollbar",ref:U,class:"flex-1",onScroll:ue},{default:T(()=>[y("div",{ref_key:"scrollContent",ref:Y,class:"flex items-center gap-18px whitespace-nowrap h-32px text-12px color-[--third-text]"},[(k(!0),_(M,null,F(A(ne),o=>(k(),N(s,{key:o.id,class:$(["h-full flex items-center gap-4px hover:color-[--main-text] group",o.id===A(z).params.id?"border-b-solid border-b-[--secondary-text] [&&]:color-[--main-text]":""]),to:`/token/${o.id}`,onClick:t[3]||(t[3]=e=>A(U)&&A(U).setScrollLeft(0))},{default:T(()=>{var t;return[w(a,{row:{logo_url:o.logo_url,symbol:o.symbol,chain:null==(t=("getAddressAndChainFromId"in e?e.getAddressAndChainFromId:A(B))(o.id))?void 0:t.chain},tokenClass:"w-16px h-16px",chainClass:"w-8px h-8px"},null,8,["row"]),I(" "+E(o.symbol)+" ",1),"circulation"in o?(k(),_(M,{key:0},[I(" $"+E(("formatNumber"in e?e.formatNumber:A(L))(new(A(v))(o.price).times(new(A(v))(o.circulation)).toFixed(),2)),1)],64)):(k(),_(M,{key:1},[I(" $"+E(("formatNumber"in e?e.formatNumber:A(L))(Number(o.balance_usd),2)),1)],64)),"total_profit_ratio"in o?(k(),_("span",{key:2,class:$(("getColorClass"in e?e.getColorClass:A(R))(Number(o.total_profit_ratio)))},E(+o.total_profit_ratio>0?"+":"")+E(("formatNumber"in e?e.formatNumber:A(L))(Number(100*+o.total_profit_ratio),2))+"%",3)):(k(),_("span",{key:3,class:$(("getColorClass"in e?e.getColorClass:A(R))(Number(o.price_change_v2)))},E(+o.price_change_v2>0?"+":"")+E(("formatNumber"in e?e.formatNumber:A(L))(Number(o.price_change_v2),2))+"%",3)),A(re)?(k(),N(r,{key:4,name:"custom:close",class:"cursor-pointer text-16px hidden group-hover:block",onClick:H(e=>{return t=o.id,void(Q.lastVisitTokens=Q.lastVisitTokens.filter(e=>e.id!==t));var t},["self","stop","prevent"])},null,8,["onClick"])):g("",!0)]}),_:2},1032,["class","to"]))),128))],512)]),_:1},512),A(ae)?(k(),_("div",{key:1,class:"w-24px h-32px flex items-center justify-center cursor-pointer text-[--secondary-text] hover:text-[--main-text]",onClick:t[4]||(t[4]=e=>ce(200))},[w(r,{name:"material-symbols:arrow-forward-ios"})])):g("",!0),C(y("div",{class:"p-8px h-32px flex items-center color-[--secondary-text] hover:color-[--main-text] gap-4px whitespace-nowrap text-12px cursor-pointer",onClick:ie},[w(r,{name:"line-md:close"}),I(" "+E(e.$t("closeAll")),1)],512),[[P,A(ne).length>=1&&A(re)]])])}}}),[["__scopeId","data-v-820a0dc5"]]),Z={class:"flex justify-between items-center px-12px py-8px text-12px h-32px color-[--third-text]"},q=["onClick"],G=["onClick"],U={key:1},X={key:2,class:"flex flex-col items-center justify-center ml-5px"},Y=["onClick"],ee=["onClick"],te=e({__name:"tHead",props:{columns:{type:Array,default:()=>[]},sort:{type:Object,default:()=>({})},toggleMode:{type:Function,default:()=>{}}},emits:["update:sort"],setup(e,{emit:t}){const r=e,a=t;function s(e,t,a){const s=r.sort.activeSort===e&&r.sort.sortBy===t;return"t"===a?s?"border-t-[--main-text]":"border-t-[--third-text]":s?"border-b-[--main-text]":"border-b-[--third-text]"}const o={0:1,1:-1,"-1":0};function n(e,t){const s={...r.sort};t?s.activeSort=t:s.sortBy!==e?s.activeSort=1:s.activeSort=o[s.activeSort],s.sortBy=e,a("update:sort",s)}return(t,r)=>{const a=S;return k(),_("div",Z,[(k(!0),_(M,null,F(e.columns,(r,o)=>(k(),_("div",{key:o,class:$(`flex items-center cursor-pointer ${r.flex}`),onClick:H(e=>n(r.value),["stop"])},[r.label?(k(),_(M,{key:0},[r.currentMode?(k(!0),_(M,{key:1},F(r.label.split("{currentMode}"),(t,s)=>(k(),_("div",{class:"flex items-center",key:s},[0===s?(k(),_("span",{key:0,onClick:H(t=>e.toggleMode(r.currentMode),["stop"])},E(t),9,G)):(k(),_("span",U,E(t),1)),0===s?(k(),N(a,{key:2,name:"custom:arrow-switch",class:"text-16px",onClick:H(t=>e.toggleMode(r.currentMode),["stop"])},null,8,["onClick"])):g("",!0)]))),128)):(k(),_(M,{key:0},[I(E(r.label),1)],64))],64)):D(t.$slots,r.value,{key:1}),r.sort?(k(),_("div",X,[y("i",{class:$(`w-0 h-0 border-solid border-4px border-transparent cursor-pointer\n            ${s(-1,r.value,"b")}\n            `),onClick:H(e=>n(r.value,-1),["stop"])},null,10,Y),y("i",{class:$(`w-0 h-0 border-solid border-4px border-transparent mt-3px cursor-pointer\n            ${s(1,r.value,"t")}\n            `),onClick:H(e=>n(r.value,1),["stop"])},null,10,ee)])):g("",!0)],10,q))),128))])}}});export{te as _,Q as a};
