import{n as a,au as e,av as t,go as l,D as r,F as i,ay as o,M as s,fm as n,c,o as m,b as u,a as d,w as p,J as f,t as g,E as b,K as v,cQ as C,d as h,a8 as x,a5 as y,c_ as S,aq as w,H as N,ax as z,S as I,bC as _,qw as j}from"./pxHhHUe5.js";import{E as O,a as V}from"./DlhmlHT6.js";import"./xG3n2otq.js";import"./uG3PizZo.js";import{a as P}from"./Dkz-6Ico.js";import{b as D}from"./CD5Fbww6.js";import"./DU6RBO19.js";import"./BC28JpVo.js";import"./Ss6PgMLe.js";import"./EKWuchHU.js";import"./B3CwgMQF.js";import"./3zf6s2PU.js";import"./BwPtREp8.js";import"./B-rSTJlV.js";import"./-qzEQscJ.js";const L=["infinite-scroll-disabled"],M={class:"text-12px"},Y={key:1},k={class:"text-14px"},B={class:"mt-[2px] mb-[5px] py-[10px] text-[12px] text-center color-[--third-text]"},H={key:0},T=a({__name:"positionHistory",props:{searchParams:{}},setup(a){const T=e(),F=a,{t:U}=t(),q=l(),A=o([]),E=i({loading:!1,finished:!1,error:!1}),K=i(""),Q=b(()=>{var a,e,t;const l=(null==(t=null==(e=null==(a=q.metadata)?void 0:a.contractList)?void 0:e.reduce)?void 0:t.call(e,(a,e)=>(a[e.contractId]=e.contractName,a),{}))||{};return l.ALL=U("all"),l}),Z=a=>Math.abs(a.cumOpenSize)!==Math.abs(a.cumCloseSize),$=a=>{var e;const t=(null==(e=q.position.find(e=>e.contractId===a.contractId))?void 0:e.openValue)||0,l=new _(0).minus(a.cumOpenValue).minus(a.cumCloseValue);return Z(a)?l.plus(t):l},J=a=>{var e;const t=$(a);if(!a.currentLeverage)return new _(0);{const l=(null==(e=q.position.find(e=>e.contractId===a.contractId))?void 0:e.openValue)||0,r=Z(a)?new _(a.cumOpenValue).abs().minus(new _(l).abs()):new _(a.cumOpenValue).abs();return r.isZero()?new _(0):t.dividedBy(r).multipliedBy(100).multipliedBy(a.currentLeverage)}},R=async()=>{var a,e;if(E.value.loading||E.value.finished)return;const t={...F.searchParams};K.value&&(t.offsetData=K.value);try{E.value.loading=!0;const l=await j(t);let r=(null==(e=null==(a=l.dataList)?void 0:a.filter)?void 0:e.call(a,a=>Math.abs(a.cumCloseSize)>0))||[];K.value&&(r=A.value.concat(r)),l.nextPageOffsetData||(E.value.finished=!0),K.value=l.nextPageOffsetData,A.value=r}catch(l){E.value.error=!0}finally{E.value.loading=!1}};T.address&&R();const W=a=>{var e,t;const l=(null==(t=null==(e=q.contractList)?void 0:e.find(e=>e.contractId===a.contractId))?void 0:t.oraclePrice)||0;return _(a.openSize).multipliedBy(l).minus(a.openValue).toString()},X=a=>{const e=W(a);return _(e).dividedBy(_(a.openValue).abs()).multipliedBy(100).multipliedBy(a.leverage).toString()};return r(()=>[F.searchParams,T.address],()=>{K.value="",A.value=[],E.value.finished=!1,E.value.error=!1,E.value.loading=!1,R()}),(a,e)=>{const t=z,l=O,r=V,i=n;return s((m(),c("div",{class:"relative min-h-400px bg-[--secondary-bg]","infinite-scroll-delay":200,"infinite-scroll-disabled":f(E).loading||f(E).finished||f(E).error,"infinite-scroll-immediate":!1,"infinite-scroll-distance":300},[u(r,{fit:"",data:f(A),"header-row-class-name":"text-12px sticky top-0 z-10 font-500","cell-class-name":"color-[--main-text] text-12px"},{empty:p(()=>{var e;return[f(E).loading||0!==(null==(e=f(A))?void 0:e.length)?(m(),c("span",Y)):(m(),N(t,{key:0,class:"pt-[40px]"},{default:p(()=>[d("span",M,g(a.$t("emptyNoData")),1)]),_:1}))]}),default:p(()=>[u(l,{label:f(U)("markets1"),prop:"contractId"},{default:p(({row:e})=>[d("span",k,g(f(Q)[e.contractId]),1),d("div",{class:v(["text-10px lh-14px",("getColorClass"in a?a.getColorClass:f(C))(e.cumOpenSize)])},g(e.cumOpenSize>0?f(U)("long"):f(U)("short")),3)]),_:1},8,["label"]),u(l,{label:f(U)("Qty"),prop:"contractSize"},{default:p(({row:e})=>[h(g(Math.abs(+("formatNumber"in a?a.formatNumber:f(x))(e.cumOpenSize)||0))+" "+g(f(Q)[e.contractId].replace("USD","")),1)]),_:1},8,["label"]),u(l,{align:"right",label:f(U)("closeSize")},{default:p(({row:e})=>[h(g(Math.abs(+("formatNumber"in a?a.formatNumber:f(x))(e.cumCloseSize)||0))+" "+g(f(Q)[e.contractId].replace("USD","")),1)]),_:1},8,["label"]),u(l,{align:"right",label:f(U)("status")},{default:p(({row:a})=>[h(g(Z(a)?f(U)("partialClose"):f(U)("closed")),1)]),_:1},8,["label"]),u(l,{align:"right",label:f(U)("openAvgPrice")},{default:p(({row:e})=>[h(g(("formatNumber"in a?a.formatNumber:f(x))(e.cumOpenValue/e.cumOpenSize,{limit:20,decimals:2})),1)]),_:1},8,["label"]),u(l,{align:"right",label:f(U)("avgPrice2")},{default:p(({row:e})=>[h(g(("formatNumber"in a?a.formatNumber:f(x))(e.cumCloseValue/e.cumCloseSize,{limit:20,decimals:2})),1)]),_:1},8,["label"]),u(l,{align:"right",label:f(U)("unrealizedPnl")},{default:p(({row:e})=>[Z(e)?(m(),c(y,{key:0},[d("div",{class:v(["lh-18px",("getColorClass"in a?a.getColorClass:f(C))(W(e))])},g(("formatNumber"in a?a.formatNumber:f(x))(W(e),2)),3),d("div",{class:v(["lh-18px",("getColorClass"in a?a.getColorClass:f(C))(X(e))])},g(("formatNumber"in a?a.formatNumber:f(x))(X(e),{limit:20,decimals:2}))+"% ",3)],64)):(m(),c(y,{key:1},[h("--")],64))]),_:1},8,["label"]),u(l,{align:"right",label:f(U)("pnl")},{default:p(({row:e})=>{var t,l,r;return[d("div",{class:v(["lh-18px",("getColorClass"in a?a.getColorClass:f(C))($(e).toString())])},g(("formatNumber"in a?a.formatNumber:f(x))($(e).toString())),3),d("div",{class:v(["lh-18px flex items-center justify-end gap-4px",("getColorClass"in a?a.getColorClass:f(C))(J(e).toString())])},[h(g(("formatNumber"in a?a.formatNumber:f(x))(J(e).toString(),{limit:20,decimals:2}))+"% ",1),u(D,{statistics:{leverage:("getLeverageFromContractId"in a?a.getLeverageFromContractId:f(P))(e.contractId)||e.maxLeverage,openValue:e.cumOpenValue,entryPrice:("formatNumber"in a?a.formatNumber:f(x))(e.cumOpenValue/e.cumOpenSize,{decimals:2,limit:20}),unrealizedPnl:$(e).toString(),unrealizedPnlRate:J(e).toString(),name:null==(l=null==(t=f(Q)[e.contractId])?void 0:t.replace)?void 0:l.call(t,"USD",""),logo_url:null==(r=f(q).contractList.find(a=>a.contractId===e.contractId))?void 0:r.baseCoinIcon,closePrice:("formatNumber"in a?a.formatNumber:f(x))(e.cumCloseValue/e.cumCloseSize,{decimals:2,limit:20})}},null,8,["statistics"])],2)]}),_:1},8,["label"]),u(l,{align:"right",label:f(U)("termCount")},{default:p(({row:e})=>[h(g(Z(e)?"--":("formatCountdown"in a?a.formatCountdown:f(S))(0,!1,f(w)(+e.updatedTime).diff(f(w)(+e.createdTime),"s"))),1)]),_:1},8,["label"]),u(l,{align:"right",label:f(U)("openTime2")},{default:p(({row:a})=>[h(g(f(w)(+a.createdTime).format("YYYY-MM-DD HH:mm:ss")),1)]),_:1},8,["label"]),u(l,{align:"right",label:f(U)("lastCloseTime")},{default:p(({row:a})=>[h(g(f(w)(+a.updatedTime).format("YYYY-MM-DD HH:mm:ss")),1)]),_:1},8,["label"])]),_:1},8,["data"]),d("div",B,[f(E).loading&&f(K)?(m(),c("span",H,g(f(U)("loading")),1)):I("",!0)])],8,L)),[[i,R]])}}});export{T as default};
