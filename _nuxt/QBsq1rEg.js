import{au as t,av as o,F as e,eF as a,dq as n,ac as s,eg as u,bC as l,ej as i,dL as r,ew as m,ek as c,er as d,eC as p,ed as h,eu as v,dX as f,et as _,eH as y,eK as k,eL as w,e7 as T}from"./pxHhHUe5.js";import{a as b,b as g}from"./Brqh9oRf.js";function x(){const x=t(),{t:S}=o(),A=e(!1);async function F(t,o){try{A.value=!0;await t.swapCallStatic();const e=t.swapInfo,a=(e.fromToken.isWrapper&&e.toToken.isETH||e.toToken.isWrapper&&e.fromToken.isETH,{from_address:e.fromToken.address,from_symbol:e.fromToken.symbol,from_amount:Number(f(e.fromTokenAmount||0,e.fromToken.decimals)),to_address:e.toToken.address,to_symbol:e.toToken.symbol,to_amount:Number(f(e.toTokenAmount||0,e.toToken.decimals)),chain:o,transaction:"",wallet_address:x.address});let s=null;t.swap().then(t=>(s=setTimeout(()=>{n({type:"success",message:S("transactionsSubmitted")})},500),b({chain:o,destination:"wallet rpc",type:10,tx_hash:t.hash,status:1,wallet:x.address,out_token:a.to_address,out_amount:Number(f(e.toTokenAmount||0,e.toToken.decimals)),in_token:a.from_address,in_amount:Number(f(e.fromTokenAmount||0,e.fromToken.decimals))}),A.value=!1,t.wait())).then(t=>{var e,a;return s&&(clearTimeout(s),s=null),n({type:"success",message:S("tradeSuccess")}),g({chain:o,tx_hash:t.hash,status:100,to:(null==(a=null==(e=null==t?void 0:t.to)?void 0:e.toLowerCase)?void 0:a.call(e))||""}),t}).catch(t=>{A.value=!1,c(t,"swap")})}catch(e){A.value=!1,c(e,"swap")}}function N(t){return T({tokenAddress:"solana"===t?"So11111111111111111111111111111111111111112":r,chain:t})}return{walletSwap:async function(t,o){var e,T,M;if(!(null==(T=null==(e=Object.keys(a).concat(["solana","sui","ton"]))?void 0:e.includes)?void 0:T.call(e,o.chain)))return void n({title:"Error",type:"error",message:S("noSupportChain",{chain:s(o.chain).name})});if(o.chain!==x.chain)return void n({title:"Error",type:"error",message:S("chainNotSame1")});A.value=!0;let O=await N(o.chain).catch(()=>({balance:"0"}));if((null==O?void 0:O.balance)<t||0===Number(null==O?void 0:O.balance))return n({title:"Error",type:"error",message:S("insufficientBalance")}),void(A.value=!1);const E=o.chain,D=o.token,B=o.amm,C=null==B?void 0:B.includes("fourmeme");if(Number(t)>0){const e=s(E).decimals;if("solana"===E)return void async function(t,o){var e;const a=t.chain;if("solana"===a){A.value=!0;const a=await h(t.token);let s=!1;const i=!1,r=9,m=null==a?void 0:a.token_decimals,d={inputMint:"So11111111111111111111111111111111111111112",inputDecimals:r,inputMintSymbol:"SOL",inputMintName:"SOL",inputAmount:o||0,outputMint:t.token,outputDecimals:m,outputMintSymbol:a.token_symbol,outputMintName:a.token_symbol,amount:u((null==(e=new l(o||0).toFixed().match(new RegExp(`[0-9]*(\\.[0-9]{0,${r}})?`)))?void 0:e[0])||0,r).toFixed(0),slippageBps:new l(30).times(100).toFixed(0),swapMode:"ExactIn",slippage:30,isPump:s,isMoonshot:i};A.value=!0;let p={};v(d).then(t=>{var o,e,a;let s="0";return t.routeInfo&&t.transaction?(p=t,s=(null==(a=null==(e=null==(o=t.routeInfo)?void 0:o.amountOut)?void 0:e.amount)?void 0:a.toFixed())||"0"):t.outAmount?(p=t,s=f(t.outAmount||"0",m)):c("can not get quote"),async function(t,o){try{A.value=!0;const e={from_address:o.inputMint,from_symbol:o.inputDecimals,from_amount:o.inputAmount,to_address:o.outputMint,to_symbol:o.outputDecimals,to_amount:o.toAmount,chain:"solana",transaction:"",wallet_address:x.address};let a=null;y(t).then(t=>(A.value=!1,a=setTimeout(()=>{n({type:"success",message:S("transactionsSubmitted")})},500),b({chain:"solana",destination:"true"===localStorage.solanaProtection?"v1/blxrsol/sendSolTx":"/ave_nodes/rpc/solana/sendFastSwapTx",type:10,tx_hash:t.hash,status:1,wallet:x.address,out_token:e.to_address,out_amount:o.toAmount,in_token:e.from_address,in_amount:o.fromAmount}),t.wait())).then(t=>{var o;return a&&(clearTimeout(a),a=null),n({type:"success",message:S("tradeSuccess")}),t&&g({chain:"solana",tx_hash:null==(o=null==t?void 0:t.transaction)?void 0:o.signatures[0],status:100}),t}).catch(t=>{"Timeout"===(t||(null==t?void 0:t.message))?n({type:"error",message:S("timeout_error")}):"Swap fail"===(t||(null==t?void 0:t.message))?n({type:"error",message:S("swapFail")}):c(t,"solana"),A.value=!1})}catch(e){A.value=!1,c(e,"solana")}}(p,{...d,toAmount:s}),t}).catch(t=>(A.value=!1,c((null==t?void 0:t.error)||t),Promise.resolve("")))}}(o,t);if("ton"===E)return void async function(t,o){var e;const a=t.chain,s=t.token;if("ton"===a){const a=9,i=(await N(s)).decimals||9,m=new l(o||0).times("0.997"),d={inputToken:"TON",outputToken:s,inputTokenAmount:u((null==(e=m.toFixed().match(new RegExp(`[0-9]*(\\.[0-9]{0,${a}})?`)))?void 0:e[0])||0,a).toFixed(0),slippageBps:new l(30).times(100).toFixed(0)};A.value=!0;let p={};_(d).then(e=>{let s="0";return e.amountOut&&e.payload?(p=e,s=f(e.amountOut||"0",i),async function(t,o){try{A.value=!0;const e={from_address:r,from_symbol:"TON",from_amount:null==o?void 0:o.fromAmount,from_decimals:null==o?void 0:o.fromDecimals,to_address:o.outputToken,to_symbol:o.toSymbol,to_amount:null==o?void 0:o.toAmount,to_decimals:null==o?void 0:o.toDecimals,chain:"ton",transaction:"",wallet_address:x.address},a=[{address:null==t?void 0:t.to,amount:null==t?void 0:t.totalTransferAmount,payload:null==t?void 0:t.payload}],s=await k(e);s&&a.push(s);let u=null;w(a).then(t=>(u=setTimeout(()=>{n({type:"success",message:S("transactionsSubmitted")})},500),b({chain:"ton",destination:"wallet rpc",type:10,tx_hash:t.hash,status:1,wallet:x.address,out_token:e.to_address,out_amount:o.toAmount,in_token:e.from_address,in_amount:o.fromAmount}),A.value=!1,t.wait())).then(async t=>(u&&(clearTimeout(u),u=null),t&&(g({chain:"ton",tx_hash:null==t?void 0:t.hash,status:100}),n({type:"success",message:S("tradeSuccess")})),t)).catch(t=>{"Timeout"===(t||(null==t?void 0:t.message))?n({type:"error",message:S("timeout_error")}):"Swap fail"===(t||(null==t?void 0:t.message))?n({type:"error",message:S("tradeFail")}):c(t),A.value=!1})}catch(e){A.value=!1,c(e)}}(p,{...d,fromAmount:o,toAmount:s,fromDecimals:a,toDecimals:i,toSymbol:t.symbol})):c("can not get quote"),e}).catch(t=>(c((null==t?void 0:t.error)||t),Promise.resolve("")))}}(o,t);A.value=!0;const a={from_token:r,to_token:D,amountIn:u((null==(M=new l(t||0).toFixed().match(new RegExp(`[0-9]*(\\.[0-9]{0,${e}})?`)))?void 0:M[0])||0,e).toFixed(0),amountOut:"0"};if(C){try{const e=await i(a,E);m({fromAmount:u(t,18).toFixed(0),fromToken:{address:r,decimals:18,symbol:"BNB",amount:u(t,18).toFixed(0)},toToken:{address:o.token,decimals:18,symbol:"",amount:(null==e?void 0:e.amountOut)||"0"},isAmountOut:!1,quoteResult:{...e}},10).then(async t=>{F({...t,isFourMeme:!0},o.chain)}).catch(t=>{c(t)}),A.value=!1}catch(I){A.value=!1,c(I)}return}d(a,"",E).then(t=>{const o=t[0];p(o,30).then(async t=>{F(t,E)}).catch(t=>{c(t)})}).catch(t=>{c(t)})}},loadingWalletSwap:A}}export{x as u};
