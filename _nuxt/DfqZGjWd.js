import{n as e,av as l,at as a,bE as t,bx as o,au as s,by as n,cc as i,c as u,H as r,o as d,a5 as c,b as v,S as m,T as p,al as b,L as y,K as f,J as g,ay as w,w as x,a as k,aa as h,t as B,ac as S,cD as T,aP as V,aY as _,d as q,M as A,P as F,cO as N,bC as C,aR as z,dq as I,bB as L,bw as E,dr as $,ds as j,dt as M,du as G,dv as P,D as R,dw as D,dx as O,dy as U}from"./pxHhHUe5.js";import{u as W}from"./QBsq1rEg.js";import{r as H,u as J}from"./Brqh9oRf.js";const K={class:"m-text"},Q={key:0,class:"ml-5px"},Y={class:"text-20px"},X={class:"min-h-60px py-10px"},Z={class:"text-16px"},ee={class:"flex mt-10px"},le={class:"m-text"},ae={key:0,class:"ml-5px"},te=e({__name:"quickSwap",props:{quickBuyValue:{},swapSetSelected:{default:void 0},row:{},appendTo:{default:"#__nuxt"},buttonBg:{default:"rgba(18, 184, 134, 0.15)"},mainNameVisible:{type:Boolean},classNames:{default:""},size:{default:"14px"},buttonType:{default:0}},emits:["submitSwap","jump"],setup(e,{emit:te}){const{walletSwap:oe,loadingWalletSwap:se}=W(),{t:ne}=l(),ie=e,ue=a(),re=w(!1),de=w(!1),ce=w(""),ve=t("noReminderQuickBuy",!1),me=te;function pe(){var e;if(me("submitSwap"),!N())return;if(re.value)return;if(1===ie.buttonType&&new C(ie.quickBuyValue||0).lte(0))return void z({type:"error",plain:!0,message:ne("buyAmountMustG0"),duration:1e3});if(new C(ie.quickBuyValue||0).lte(0))return void I({title:"Error",type:"error",message:ne("amountMustG0")});const{row:l}=ie;ce.value=ne("quickBuyMsg",{a:ie.quickBuyValue,m:(null==(e=S(ie.row.chain))?void 0:e.main_name)||"",s:l.symbol||(l.target_token==l.token0_address?l.token0_symbol:l.token1_symbol)}),ve.value||1===ie.buttonType?ge():de.value=!0}const be=w(),ye=o(),fe=s();async function ge(){var e;if(fe.provider&&fe.address&&!ue.evmAddress)return void async function(){const e=new C(ie.quickBuyValue||0).toFixed();oe(e,ie.row)}();de.value=!1;const{chain:l}=ie.row;re.value=!0,await async function(e){var l,a,t,o;const s=ue.getWalletAddress(e);if(!s)return;const n=null==(l=ue.userInfo.addresses.find(l=>l.chain===e))?void 0:l.balance;let i={chain:e,token:$(e),address:$(e),decimals:null==(a=S(e))?void 0:a.decimals,symbol:null==(t=S(e))?void 0:t.main_name};if(n)return void(be.value={...i,balance:n});if(fe.address&&!ue.evmAddress){const l=await D({chain:e,tokens:[$(e)],walletAddress:s});i=(null==l?void 0:l[0])||{},be.value={...i,symbol:null==(o=S(e))?void 0:o.main_name,chain:e,address:i.token||i.address,decimals:i.decimals||i.decimal}}}(l);const a=be.value,t=null==(e=new C(ie.quickBuyValue||0).toFixed().match(new RegExp(`[0-9]*(\\.[0-9]{0,${(null==a?void 0:a.decimals)||18}})?`)))?void 0:e[0];return(Number(t)||0)<=0?(I({title:"Error",type:"error",message:ne("amountTooSmall")}),void(re.value=!1)):new C(t||0).gt((null==a?void 0:a.balance)||0)&&void 0!==(null==a?void 0:a.balance)?(I({title:"Error",type:"error",message:ne("insufficientBalance")}),void(re.value=!1)):void async function(e){var l,a,t,o,s;const{chain:n}=ie.row,i="solana"===n,{botSettings:u}=ye,r=ie.swapSetSelected||(null==(a=null==(l=null==u?void 0:u[n])?void 0:l.buy)?void 0:a.selected),d=null==(o=null==(t=null==u?void 0:u[n])?void 0:t.buy)?void 0:o[r],{gasTip1List:c,gasTip2List:v}=L(E().gasTip,n),m=(null==d?void 0:d.mev)?c:v,p=(null==d?void 0:d.mev)?null==d?void 0:d.gas[0]:null==(s=null==d?void 0:d.gas)?void 0:s[1];let b={};if(i){let e=(null==p?void 0:p.customFee)||(null==m?void 0:m[null==p?void 0:p.level])||"0.002";(null==d?void 0:d.mev)&&new C(e).lt("0.002")&&(e="0.002"),b.priorityFee=new C(e).times(10**9).toFixed(0)}else if("ton"!==n){const e=0===Number(null==p?void 0:p.customFee)?"0":(null==p?void 0:p.customFee)||(null==m?void 0:m[null==p?void 0:p.level])||"3";b.gasTip=Number(new C(e).times(10**9).toFixed(0)),b.contractType=0,b.chain=n}const y=$(n),f=(null==d?void 0:d.slippage)||"9",g=ue.getWalletAddress(n);if(!g)return;const w=Date.now().toString();b={...b,swapList:[{batchId:w,creatorAddress:g,inAmount:new C(e||0).times(10**be.value.decimals||0).toFixed(0)}],inTokenAddress:y,outTokenAddress:ie.row.token||ie.row.target_token,swapType:1,isPrivate:(null==d?void 0:d.mev)||!1,slippage:"auto"!==f?Number(new C(f).times(100).toFixed(0)):900,autoSell:ye.autoSellConfig_autoSell||!1,autoSellConfig:null==ye?void 0:ye.selectedAutoSellConfig,autoGas:(null==p?void 0:p.customFee)?0:((null==p?void 0:p.level)||0)+1,autoSellGas:(null==p?void 0:p.customFee)?0:((null==p?void 0:p.level)||0)+1,autoSellPriorityFee:i?b.priorityFee:b.gasTip};let x=j;i?x=O:"ton"===n&&(x=U);x(b).then(e=>function(e,l){if(e){const a=ie.row.chain,t=(null==e?void 0:e[0])||{};if(G(t))return M(P(t)),void(re.value=!1);let o=setTimeout(()=>{we.placeOrderUpdate++,re.value=!1},500);const s={solana:"/botapi/swap/createSolTx",ton:"/botapi/swap/createSwapTonTx"};H({txInfo:t,chain:a,destination:(null==s?void 0:s[a])||"/botapi/swap/createSwapEvmTx",type:10});const n={[null==t?void 0:t.batchId]:null==t?void 0:t.id},i=R(()=>xe.wsResult.tgbot,e=>{var a,t,s,u,r;const d=e.batchId;if(d===l){if(o&&(clearTimeout(o),o=null),we.placeOrderSuccess++,null==(t=null==(a=null==e?void 0:e.txList)?void 0:a[0])?void 0:t.success){I({type:"success",message:ne("tradeSuccess")}),me("jump");const l=null==(s=null==e?void 0:e.txList)?void 0:s[0];J({...l,chain:null==e?void 0:e.chain},(null==n?void 0:n[d])||"")}else M((null==(r=null==(u=null==e?void 0:e.txList)?void 0:u[0])?void 0:r.failMessage)||"swap error");i(),re.value=!1}})}}(e,w)).catch(e=>{M(e||"swap error"),re.value=!1})}(t)}const we=n(),xe=i();return(l,a)=>{const t=h,o=p,s=_,n=T;return 0===e.buttonType?(d(),u(c,{key:0},[v(o,{disabled:!Number(e.quickBuyValue),loading:g(re)||g(se),color:e.buttonBg,class:f(["flex items-center [&&]:px-8px [&&]:py-5px [&&]:h-auto",e.classNames]),style:y([{"--el-button-hover-bg-color":"rgba(18, 184, 134, 0.3)","--el-color-black":"#12B886","--el-button-border-color":"transparent","--el-button-hover-border-color":"transparent","--el-button-disabled-text-color":"#12B886","--el-button-disabled-border-color":"transparent","--el-button-disabled-bg-color":"#12B8861A"},{"font-size":e.size}]),onClick:b(pe,["stop","prevent"])},{default:x(()=>{var a;return[g(re)||g(se)?m("",!0):(d(),r(t,{key:0,style:y({"font-size":e.size}),class:"mr-4px",name:"mynaui:lightning-solid"},null,8,["style"])),k("div",K,[k("span",null,B(e.quickBuyValue||0),1),e.mainNameVisible?(d(),u("span",Q,B((null==(a=("getChainInfo"in l?l.getChainInfo:g(S))(e.row.chain))?void 0:a.main_name)||""),1)):m("",!0)])]}),_:1},8,["disabled","loading","color","class","style"]),g(de)?(d(),r(n,{key:0,modelValue:g(de),"onUpdate:modelValue":a[1]||(a[1]=e=>V(de)?de.value=e:null),title:l.$t("buy"),width:"400px","append-to":e.appendTo,"destroy-on-close":""},{header:x(()=>[k("span",Y,B(l.$t("buy")),1)]),footer:x(()=>[v(o,{type:"primary",class:"w-full",size:"large",onClick:b(ge,["stop"])},{default:x(()=>[q(B(l.$t("confirm1")),1)]),_:1})]),default:x(()=>[k("div",X,[k("div",Z,B(g(ce)),1),k("div",ee,[v(s,{modelValue:g(ve),"onUpdate:modelValue":a[0]||(a[0]=e=>V(ve)?ve.value=e:null),class:"[&&]:[--el-checkbox-text-color:--d-999-l-666]",label:l.$t("noAlert"),size:"large"},null,8,["modelValue","label"])])])]),_:1},8,["modelValue","title","append-to"])):m("",!0)],64)):(d(),r(o,{key:1,loading:g(re)||g(se),color:e.buttonBg,class:f(["flex items-center [&&]:px-4px",e.classNames]),style:y([{"--el-button-hover-bg-color":"rgba(18, 184, 134, 0.3)","--el-color-black":"#12B886","--el-button-border-color":"transparent","--el-button-hover-border-color":"transparent","--el-button-disabled-text-color":"#12B886","--el-button-disabled-border-color":"transparent","--el-button-disabled-bg-color":"#12B8861A"},{"font-size":e.size}]),onClick:b(pe,["stop","prevent"])},{default:x(()=>{var a;return[A(v(t,{class:"mr-4px text-12px",name:"mynaui:lightning-solid"},null,512),[[F,!g(re)]]),k("div",le,[q(B(Number(e.quickBuyValue)?e.quickBuyValue||0:l.$t("buy"))+" ",1),e.mainNameVisible&&Number(e.quickBuyValue)?(d(),u("span",ae,B((null==(a=("getChainInfo"in l?l.getChainInfo:g(S))(e.row.chain))?void 0:a.main_name)||""),1)):m("",!0)])]}),_:1},8,["loading","color","class","style"]))}}});export{te as _};
